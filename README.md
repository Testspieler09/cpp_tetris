# Tetris with SRS (Super Rotation System)

A Tetris implementation in C++17 with the Super Rotation System, featuring hold/swap functionality and a clean separation between game logic and rendering.

## Architecture

This project follows a **loosely coupled** design with clear separation between the game engine (core logic) and UI (rendering):

```
┌──────────────────────────────────────────────────┐
│                         main.cpp                 │
│  - Initializes Game (implements IGameEngine)     │
│  - Passes Game to Renderer                       │
│  - Calls Renderer::run()                         │
└──────────────────────────────────────────────────┘
            │                          │
            ▼                          ▼
┌──────────────────────┐    ┌──────────────────────┐
│   Engine (Logic)     │    │   UI (Rendering)     │
│   - Pure C++         │    │   - Uses raylib      │
│   - No graphics deps │◄───│   - Calls interface  │
│   - Implements       │    │     methods only     │
│     IGameEngine      │    │                      │
└──────────────────────┘    └──────────────────────┘
```

### Key Design Principles

1. **Interface-Based Communication**: Game implements `IGameEngine` interface
2. **GameState Struct**: Pure data structure (no methods) passed from engine to UI
3. **Event-Driven Input**: UI translates input to `GameEvent` enum
4. **Zero Coupling**: Engine has NO knowledge of raylib or rendering

### Core Components

#### Engine (`src/engine/`)

- **IGameEngine** - Interface defining the contract between engine and UI
- **GameState** - Pure data struct for rendering (no methods, no dependencies)
- **Game** - Main game logic, implements IGameEngine
- **Tetromino** - Represents a single piece (type, orientation, position, shape)
- **PieceRotation** - SRS wall kick tables and rotation logic
- **PieceGenerator** - 7-bag randomizer for piece generation

#### UI (`src/ui/`)

- **Renderer** - Handles all raylib rendering and game loop
    - Owns the main `while` loop
    - Calls `game.update(deltaTime)` at 60 ticks/sec
    - Translates input to `GameEvent` and calls `game.handleEvent()`
    - Reads game state via `game.getState()` for rendering

## Features

- [x] Super Rotation System (SRS) with proper wall kicks
- [x] Hold/Swap piece functionality (once per piece)
- [x] Ghost piece showing landing position
- [x] 7-bag randomizer (modern Tetris standard)
- [x] Next piece preview (2 pieces shown)
- [x] Scoring system with level progression
- [x] Soft drop and hard drop
- [x] Game over detection

## Build Instructions

### Prerequisites

- C++17 compatible compiler (g++, clang++)
- Git (for submodules)
- Make

### Setup

1. **Clone and initialize submodules**:

```bash
git submodule add https://github.com/raysan5/raylib.git external/raylib
git submodule update --init --recursive
```

2. **Build the project**:

```bash
make
```

3. **Run the game**:

```bash
make run
# or directly:
./build/tetris
```

4. **Clean build files**:

```bash
make clean      # Clean build files only
make cleanall   # Clean build files and raylib
```

## Controls

| Key   | Action                   |
| ----- | ------------------------ |
| ←/→   | Move left/right          |
| ↓     | Soft drop (faster fall)  |
| ↑     | Hard drop (instant fall) |
| X     | Rotate clockwise         |
| Z     | Rotate counter-clockwise |
| Space | Hold/swap piece          |
| R     | Restart game             |

> [!NOTE]
>
> You can use vim keys `[h j k l]` instead of the arrow keys to move and drop the pieces

## Project Structure

```
.
├── include/
│   ├── engine/
│   │   ├── igame_engine.hpp       # Interface + GameState + enums
│   │   ├── game.hpp               # Main game logic
│   │   ├── tetromino.hpp          # Piece representation
│   │   ├── piece_rotation.hpp     # SRS wall kicks
│   │   └── piece_generator.hpp    # 7-bag randomizer
│   └── ui/
│       └── renderer.hpp           # Raylib rendering
├── src/
│   ├── engine/
│   │   ├── game.cpp
│   │   ├── tetromino.cpp
│   │   ├── piece_rotation.cpp
│   │   └── piece_generator.cpp
│   ├── ui/
│   │   └── renderer.cpp
│   └── main.cpp
├── external/
│   └── raylib/                    # Git submodule
├── build/                         # Generated by make
├── Makefile
└── README.md
```

## Technical Details

### Game Loop

The renderer runs at 60 FPS with fixed timestep updates:

### SRS Implementation

Wall kicks are implemented according to the [Tetris Guideline](https://harddrop.com/wiki/SRS):

- JLSTZ pieces: 5 kick tests per rotation
- I-piece: Different kick table (5 tests)
- O-piece: No rotation

### Scoring

- Lines cleared: 40 (1 line) / 100 (2) / 300 (3) / 1200 (4) × level
- Soft drop: +1 point per cell
- Hard drop: +2 points per cell
- Level up: Every 10 lines cleared

## Troubleshooting

### Compilation errors about raylib.h

- raylib didn't build. Try:
    ```bash
    cd external/raylib/src
    make PLATFORM=PLATFORM_DESKTOP
    cd ../../..
    make
    ```

### Linker errors on macOS

- Make sure you have Xcode Command Line Tools:
    ```bash
    xcode-select --install
    ```

### Need to rebuild everything?

```bash
make cleanall  # Clean build files AND raylib
make           # Rebuild from scratch
```

## License

See LICENSE file for details.
